(window.webpackJsonp=window.webpackJsonp||[]).push([[156],{"4q8G":function(e,t,n){"use strict";var r=n("t0aI");t.a=({sort_event_id:e},{sort_event_id:t})=>e?t?Object(r.a)(t,e):1:-1},AQ79:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s}));const r="directMessages",a=`rweb/${r}`,s=e=>`${a}/${e}`},MMRb:function(e,t,n){"use strict";n.r(t),n.d(t,"GLOBAL_STATE_KEY",(function(){return c.a})),n.d(t,"CONVERSATION_TYPE",(function(){return P.a})),n.d(t,"ENTRY_TYPE",(function(){return P.b})),n.d(t,"PAGINATION_STATUS",(function(){return P.c})),n.d(t,"addParticipants",(function(){return a.d})),n.d(t,"selectConversation",(function(){return a.u})),n.d(t,"selectConversationAvatarMediaId",(function(){return a.v})),n.d(t,"selectConversationFetchStatus",(function(){return a.y})),n.d(t,"selectConversationIsLoaded",(function(){return a.z})),n.d(t,"selectConversationIsRead",(function(){return a.A})),n.d(t,"selectConversationAvatarMediaIsUploading",(function(){return a.w})),n.d(t,"selectConversationAvatarMediaUploadProgress",(function(){return a.x})),n.d(t,"selectConversations",(function(){return a.C})),n.d(t,"selectHasConversations",(function(){return a.D})),n.d(t,"selectInboxTypeByConversation",(function(){return a.E})),n.d(t,"selectEntries",(function(){return s.l})),n.d(t,"selectEntriesForConversation",(function(){return s.m})),n.d(t,"selectEntry",(function(){return s.n})),n.d(t,"selectConversationIdsByInbox",(function(){return i.m})),n.d(t,"selectFetchStatus",(function(){return i.p})),n.d(t,"selectInboxIsLoaded",(function(){return i.q})),n.d(t,"selectIsLoadingTop",(function(){return i.r})),n.d(t,"selectUnreadCount",(function(){return i.t})),n.d(t,"selectUntrustedCursor",(function(){return i.v})),n.d(t,"selectUntrustedUnreadCount",(function(){return i.y})),n.d(t,"selectUntrustedConversationCount",(function(){return i.u})),n.d(t,"selectUntrustedLowQualityCursor",(function(){return i.x})),n.d(t,"selectUntrustedLowQualityConversationCount",(function(){return i.w})),n.d(t,"selectPoppedOutConversationId",(function(){return i.s})),n.d(t,"selectDrawerVisibility",(function(){return i.o})),n.d(t,"selectDrawerExperimentEnabled",(function(){return i.n})),n.d(t,"selectSearchConversations",(function(){return N})),n.d(t,"selectSearchCursor",(function(){return R})),n.d(t,"selectSearchFetchStatus",(function(){return D})),n.d(t,"selectRecentSearches",(function(){return C})),n.d(t,"selectSearchQuery",(function(){return h})),n.d(t,"selectUpdates",(function(){return L.e})),n.d(t,"acceptConversation",(function(){return a.a})),n.d(t,"addAvatarMedia",(function(){return a.b})),n.d(t,"addWelcomeMessageToConversation",(function(){return a.e})),n.d(t,"disableMentionNotifications",(function(){return a.g})),n.d(t,"disableNotifications",(function(){return a.h})),n.d(t,"enableMentionNotifications",(function(){return a.i})),n.d(t,"enableNotifications",(function(){return a.j})),n.d(t,"fetchConversation",(function(){return a.k})),n.d(t,"fetchConversationFromParticipants",(function(){return a.l})),n.d(t,"fetchConversationIfNeeded",(function(){return a.n})),n.d(t,"fetchConversationHistory",(function(){return a.m})),n.d(t,"leaveConversation",(function(){return a.o})),n.d(t,"markAllAsRead",(function(){return a.p})),n.d(t,"markConversationRead",(function(){return a.q})),n.d(t,"muteDMUser",(function(){return a.r})),n.d(t,"unmuteDMUser",(function(){return a.H})),n.d(t,"removeAvatarMedia",(function(){return a.s})),n.d(t,"removeConversation",(function(){return a.t})),n.d(t,"setConversationAvatar",(function(){return a.F})),n.d(t,"toggleNotifications",(function(){return a.G})),n.d(t,"updateConversationReadState",(function(){return a.M})),n.d(t,"updateConversationAvatar",(function(){return a.I})),n.d(t,"updateConversationName",(function(){return a.K})),n.d(t,"updateTyping",(function(){return a.N})),n.d(t,"fetchInbox",(function(){return i.e})),n.d(t,"fetchInboxIfNeeded",(function(){return i.f})),n.d(t,"fetchTrustedInboxHistory",(function(){return i.g})),n.d(t,"fetchUntrustedInboxHistory",(function(){return i.h})),n.d(t,"fetchUntrustedLowQualityInboxHistory",(function(){return i.i})),n.d(t,"updateLastSeenEventId",(function(){return i.A})),n.d(t,"updateTrustedLastSeenEventId",(function(){return i.B})),n.d(t,"updateUntrustedLastSeenEventId",(function(){return i.C})),n.d(t,"popOutConversation",(function(){return i.l})),n.d(t,"setDrawerVisibility",(function(){return i.z})),n.d(t,"loadDrawerVisibilityFromPersistence",(function(){return i.k})),n.d(t,"deleteEntry",(function(){return s.f})),n.d(t,"markSpamStatus",(function(){return s.h})),n.d(t,"removeEntry",(function(){return s.j})),n.d(t,"addRecentSearches",(function(){return j})),n.d(t,"clearRecentSearches",(function(){return U})),n.d(t,"clearRecentSearch",(function(){return g})),n.d(t,"clearSearchCache",(function(){return S})),n.d(t,"clearCurrentSearch",(function(){return A})),n.d(t,"searchConversations",(function(){return M})),n.d(t,"fetchUpdates",(function(){return L.b})),n.d(t,"fetchUpdatesIfNeeded",(function(){return L.d}));var r=n("9OUN"),a=n("lRnM"),s=n("uKEd"),c=n("AQ79"),i=n("xPna"),o=n("Ssj5"),d=n("oEOe"),u=n("RqPI"),_=n("kGix"),E=n("WVrH");const l="rweb.recentDMSearches",I=d.a(c.b,"SEARCH"),O=Object(c.c)("ADD_RECENT_SEARCHES"),f=e=>({payload:e,type:O}),v=Object(c.c)("CLEAR_CURRENT_SEARCH"),A=()=>({type:v}),p=Object(c.c)("CLEAR_SEARCH_CACHE"),S=()=>({type:p}),y=Object(c.c)("CLEAR_RECENT_SEARCH"),b=Object(c.c)("CLEAR_RECENT_SEARCHES"),T={cursor:"",conversationIds:[],cachedSearchQueries:[],fetchStatus:_.a.NONE,query:"",recentSearches:[]};function m(e=T,t){switch(t.type){case O:case y:return{...e,recentSearches:t.payload};case b:return{...e,recentSearches:[]};case I.REQUEST:return{...e,fetchStatus:_.a.LOADING};case I.FAILURE:return{...e,fetchStatus:_.a.FAILED,error:t.payload};case I.SUCCESS:{const n=t.payload&&t.payload.result?t.payload.result:null,{conversations:r,cursor:a,query:s}=n,{error:c,...i}=e,o=r?Object.keys(r):[],d=s===e.query?(e.conversationIds||[]).concat(o):o,{cachedQuery:u}=t.meta||{};return{...i,cachedSearchQueries:u?(e.cachedSearchQueries||[]).concat(Object.assign({},t.meta,{result:n})):e.cachedSearchQueries,conversationIds:d,cursor:a,query:s,fetchStatus:_.a.LOADED}}case v:return{...T,cachedSearchQueries:e.cachedSearchQueries,recentSearches:e.recentSearches};case p:case E.a:return{...T,recentSearches:e.recentSearches};default:return e}}const N=e=>{var t;return null==(t=e[c.a].search)?void 0:t.conversationIds},C=e=>{var t;return null==(t=e[c.a].search)?void 0:t.recentSearches},R=e=>{var t;return null==(t=e[c.a].search)?void 0:t.cursor},D=e=>{var t;return null==(t=e[c.a].search)?void 0:t.fetchStatus},h=e=>{var t;return null==(t=e[c.a].search)?void 0:t.query},M=e=>(t,n,{api:r})=>{var a;const s=n(),{directMessages:o={}}=s,{cursor:u}=o.search,{query:_}=e||{},E={...e,search_type:"conversations"};u&&(null==(a=o.search)?void 0:a.query)===_&&(E.cursor=u);const l=(e=>{var t;return null==(t=e[c.a].search)?void 0:t.cachedSearchQueries})(s).find((e=>e.cachedQuery===_&&e.cachedCursor===E.cursor)),O=d.b(t,{params:E,request:r.DirectMessages.search}),f=e=>{if(e&&e.result){const{conversations:t}=e.result,{users:n}=e.entities;return t&&Object.values(t).forEach((e=>e.isSearchResult=!0)),t?Object(i.c)({conversations:t,users:n}):null}};return l?t({type:Object(c.c)("SEARCH_SUCCESS"),payload:{result:null==l?void 0:l.result}}):O({actionTypes:I,context:"SEARCH",meta:{cachedQuery:E.query,cachedCursor:E.cursor}},f)},j=e=>(t,n,{userPersistence:r,featureSwitches:a})=>{const s=a.getNumberValue("dm_inbox_search_max_recent_searches_stored");return r.get(l).then((n=>{const a=(null==n?void 0:n.recentSearches)||[];return!a.includes(e)&&a.push(e),a.length>s&&a.shift(),t(f(a)),r.set(l,{recentSearches:a})}))},g=e=>(t,n,{userPersistence:r})=>r.get(l).then((n=>{const a=(null==n?void 0:n.recentSearches)||[];return a.splice(a.indexOf(e),1),t({payload:a,type:y}),r.set(l,{recentSearches:a})})),U=()=>(e,t,{userPersistence:n})=>(e({type:b}),n.set(l,{recentSearches:[]}));o.a.register({[c.a]:m},(()=>(e,t,{userPersistence:n})=>u.e(t())?Promise.resolve(n.get(l).then((t=>{const n=null==t?void 0:t.recentSearches;t&&e(f(n))}))).then((()=>{})):Promise.resolve()));var L=n("xCUF"),P=n("aWyx");const x=Object(r.c)({conversations:a.f,entries:s.e,inbox:i.d,search:m,updates:L.a});o.a.register({[c.a]:x});t.default=x},WVrH:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var r=n("AQ79");const a=Object(r.c)("RESET"),s=()=>({type:a})},aWyx:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return c}));const r=Object.freeze({ONE_TO_ONE:"ONE_TO_ONE",GROUP:"GROUP_DM"}),a=Object.freeze({AT_END:"AT_END",HAS_MORE:"HAS_MORE"}),s=Object.freeze({CONVERSATION_AVATAR_UPDATE:"conversation_avatar_update",CONVERSATION_NAME_UPDATE:"conversation_name_update",CONVERSATION_PROFILE_INFO_HEADER:"conversation_profile_info_header",CONVERSATION_READ:"conversation_read",CONVO_METADATA_UPDATE:"convo_metadata_update",DISABLE_NOTIFICATIONS:"disable_notifications",ENABLE_NOTIFICATIONS:"enable_notifications",JOIN_CONVERSATION:"join_conversation",MARK_ALL_AS_READ:"mark_all_as_read",MENTION_NOTIFICATIONS_UPDATE:"mention_notifications_setting_update",MESSAGE:"message",MESSAGE_DELETE:"message_delete",MESSAGE_MARK_AS_NOT_SPAM:"message_unmark_as_spam",MESSAGE_MARK_AS_SPAM:"message_mark_as_spam",PARTICIPANTS_JOIN:"participants_join",PARTICIPANTS_LEAVE:"participants_leave",REACTION_CREATE:"reaction_create",REACTION_DELETE:"reaction_delete",READ_ONLY_INDICATOR:"read_only_indicator",REMOVE_CONVERSATION:"remove_conversation",TRUST_CONVERSATION:"trust_conversation",TYPING_INDICATOR:"typing_indicator",WELCOME_MESSAGE:"welcome_message_create"}),c=Object.freeze({MUTUAL_FRIENDS:"mutual_friends"})},lRnM:function(e,t,n){"use strict";n.d(t,"f",(function(){return V})),n.d(t,"u",(function(){return B})),n.d(t,"y",(function(){return q})),n.d(t,"z",(function(){return F})),n.d(t,"C",(function(){return H})),n.d(t,"D",(function(){return G})),n.d(t,"E",(function(){return k})),n.d(t,"B",(function(){return K})),n.d(t,"A",(function(){return W})),n.d(t,"v",(function(){return Y})),n.d(t,"w",(function(){return J})),n.d(t,"x",(function(){return X})),n.d(t,"d",(function(){return z})),n.d(t,"k",(function(){return $})),n.d(t,"l",(function(){return Z})),n.d(t,"n",(function(){return ee})),n.d(t,"m",(function(){return te})),n.d(t,"a",(function(){return ne})),n.d(t,"r",(function(){return re})),n.d(t,"H",(function(){return ae})),n.d(t,"o",(function(){return ce})),n.d(t,"c",(function(){return oe})),n.d(t,"p",(function(){return ue})),n.d(t,"q",(function(){return _e})),n.d(t,"M",(function(){return Ee})),n.d(t,"t",(function(){return Ie})),n.d(t,"G",(function(){return fe})),n.d(t,"h",(function(){return ve})),n.d(t,"j",(function(){return Ae})),n.d(t,"g",(function(){return pe})),n.d(t,"i",(function(){return Se})),n.d(t,"N",(function(){return ye})),n.d(t,"K",(function(){return be})),n.d(t,"L",(function(){return Te})),n.d(t,"J",(function(){return Ne})),n.d(t,"b",(function(){return Re})),n.d(t,"s",(function(){return he})),n.d(t,"I",(function(){return je})),n.d(t,"F",(function(){return Ue})),n.d(t,"e",(function(){return Le}));n("kYxP");var r=n("oEOe"),a=n("AspN"),s=n("RqPI"),c=n("AQ79"),i=n("/kEJ"),o=n("pXBW"),d=n("hqKg"),u=n("k49u"),_=n("/NU0"),E=n("aWyx"),l=n("WVrH"),I=n("G6rE"),O=n("uKEd"),f=n("xPna"),v=n("k6jb"),A=n("kGix"),p=n("t0aI");const S="ACTION_DM_ADD_PARTICIPANTS",y=r.a(c.b,"ACCEPT_CONVERSATION"),b=r.a(c.b,"MUTE_DM_USER"),T=r.a(c.b,"ADD_PARTICIPANTS"),m=r.a(c.b,"FETCH_CONVERSATION"),N=r.a(c.b,"FETCH_CONVERSATION_FROM_PARTICIPANTS"),C=r.a(c.b,"LEAVE_CONVERSATION"),R=r.a(c.b,"MARK_CONVERSATION_READ"),D=r.a(c.b,"DISABLE_MENTION_CONVERSATION_NOTIFICATIONS"),h=r.a(c.b,"DISABLE_CONVERSATION_NOTIFICATIONS"),M=r.a(c.b,"ENABLE_MENTION_CONVERSATION_NOTIFICATIONS"),j=r.a(c.b,"ENABLE_CONVERSATION_NOTIFICATIONS"),g=r.a(c.b,"UPDATE_CONVERSATION_NAME"),U=r.a(c.b,"UPLOAD_MEDIA"),L=r.a(c.b,"UPDATE_GROUP_AVATAR"),P=(e,t)=>t+36e5*e,x={};function V(e=x,t){switch(t.type){case y.SUCCESS:{const{conversationId:n}=t.meta,r=e[n];return{...e,[n]:{...r,data:{...r.data,trusted:!0}}}}case ie:{const n=Object.entries(t.payload||{}).reduce(((t,[n,r])=>(t[n]={...w(e[n],r),fetchStatus:{[v.a]:A.a.LOADED,[v.b]:A.a.LOADED}},t)),{});return{...e,...n}}case T.REQUEST:{const n=t.meta.conversationId,r=e[n];return{...e,[n]:{...r,fetchStatus:{...r.fetchStatus,[v.b]:A.a.LOADING}}}}case T.FAILURE:{const n=t.meta.conversationId,r=e[n];return{...e,[n]:{...r,fetchStatus:{...r.fetchStatus,[v.b]:A.a.FAILED}}}}case T.SUCCESS:{const n=t.meta.conversationId,r=e[n],a=r.data.participants,s=t.payload.entities.entries?Object.values(t.payload.entities.entries)[0].participants:[];return{...e,[n]:{...r,fetchStatus:{...r.fetchStatus,[v.b]:A.a.LOADED},data:{...r.data,participants:[...a,...s]}}}}case m.REQUEST:{const{conversationId:n,direction:r=v.a}=t.meta,a=e[n];return{...e,[n]:{...a,fetchStatus:{...a&&a.fetchStatus||{},[r]:A.a.LOADING}}}}case m.FAILURE:{const{conversationId:n,direction:r=v.a}=t.meta,a=e[n];return{...e,[n]:{...a,fetchStatus:{...a&&a.fetchStatus||{},[r]:A.a.FAILED},error:t.payload}}}case m.SUCCESS:{const{conversationId:n,direction:r=v.a}=t.meta;return{...e,[n]:{...e[n],fetchStatus:{...e[n]&&e[n].fetchStatus||{},[r]:A.a.LOADED}}}}case de:return Object.entries(e).reduce(((n,[r,a])=>(n[r]=w(e[r],{last_read_event_id:t.payload}),n)),{});case R.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{last_read_event_id:t.meta.lastReadEventId})};case b.SUCCESS:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{muted:t.meta.mute})};case le:{const{[t.payload]:n,...r}=e;return r}case C.REQUEST:return{...e,[t.meta.conversationId]:{...e[t.meta.conversationId],isDeleted:!0}};case Oe:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{notifications_disabled:!t.payload})};case h.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{notifications_disabled:!0,mute_expiration_time:(n=(new Date).getTime(),[void 0,P(1,n),P(8,n),P(168,n)])[t.meta.duration]})};case D.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{mention_notifications_disabled:!0})};case j.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{notifications_disabled:!1})};case M.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{mention_notifications_disabled:!1})};case Me:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{avatar_image_https:t.payload})};case g.REQUEST:case g.SUCCESS:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{name:t.meta.name})};case me:{const n=e[t.meta.conversationId],r=n&&n.data&&n.data.max_entry_id||"0";return Object(p.b)(t.payload,r)?{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{max_entry_id:t.payload})}:e}case U.REQUEST:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{isUploading:!0})};case U.FAILURE:case U.SUCCESS:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{isUploading:!1})};case Ce:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{avatarMediaId:t.payload})};case De:return{...e,[t.meta.conversationId]:w(e[t.meta.conversationId],{avatarMediaId:null})};case l.a:return x;default:return e}var n}const w=(e={},t={},n=[])=>{const{error:r,...a}=e,{avatarMediaId:s=null}=Object(_.a)(t.avatarMediaId)?t:a,{isUploading:c=!1}=t,{avatarMediaId:i,isUploading:o,max_entry_id:d,...u}=t,E={...a&&a.data,...u};E.isSearchResultOnly=!(null!=a&&a.data)&&u.isSearchResult;var l,I;return!!u.conversation_id&&!u.convo_label&&delete E.convo_label,d&&(E.max_entry_id=(l=d,I=a&&a.data&&a.data.max_entry_id,Object(p.c)(l,I)?l:I)),{...a,avatarMediaId:s,data:E,isUploading:c}},B=(e,t)=>e[c.a].conversations[t],q=(e,t)=>{const n=B(e,t);return n&&n.fetchStatus?Object(A.b)(n.fetchStatus,n.data):A.a.LOADED},F=(e,t)=>{const n=B(e,t);return!(!n||!n.fetchStatus)&&Object(A.b)(n.fetchStatus,n.data)===A.a.LOADED},Q=(e,t)=>{const n=B(e,t);return!(!n||!n.fetchStatus)&&n.fetchStatus[v.a]===A.a.LOADING},H=Object(d.createSelector)((e=>e[c.a].conversations),(e=>Object.entries(e).reduce(((e,[t,n])=>(n.data&&!n.isDeleted&&(e[t]=n),e)),{}))),G=e=>Object.keys(H(e)).length>0,k=(e,t)=>{if(!t)return;const n=F(e,t),r=Object(f.m)(e,f.b.secondary),a=Object(f.m)(e,f.b.tertiary);return n?r.includes(t)?f.b.secondary:a.includes(t)?f.b.tertiary:f.b.primary:void 0},K=(e,t)=>{const{data:n}=B(e,t)||{},{sort_event_id:r}=n||{};if(r){const t=s.h(e),{message_data:n,by_user_id:a,id:c,sender_id:i}=Object(O.n)(e,r)||{};if(i&&i!==t||n&&n.sender_id!==t||a&&a!==t)return c}return null},W=(e,t)=>{const n=K(e,t),{data:r}=B(e,t)||{};return!n||!!(r&&r.last_read_event_id&&Object(p.c)(r.last_read_event_id,n))},Y=(e,t)=>{const{avatarMediaId:n}=B(e,t)||{};return n},J=(e,t)=>{const{isUploading:n}=B(e,t)||{};return n},X=(e,t)=>a.i(e,Y(e,t)),z=(e,t)=>(n,a,{api:s})=>{const c=t.join(",");return r.b(n,{params:{conversationId:e,joinedParticipantIds:c},request:s.DirectMessages.addParticipants})({actionTypes:T,context:S,meta:{conversationId:e,participantIds:t}},(e=>{if(e){const{entities:t}=e;return[t.entries&&Object(O.a)(t.entries),Object(i.c)(t)]}})).then((e=>{const t=e.result.failed_participants;if(!t)return Promise.resolve(e);const n=Object.keys(t),r=1===n.length?t[n[0]]:u.a.DefaultApiError,a=new o.a("addParticpants URL",500,e.headers,[{code:r}]);return a.context.action=S,Promise.reject(a)}))},$=(e={})=>(t,n,{api:a})=>{const{conversationId:s,context:c}=e;return r.b(t,{params:e,request:a.DirectMessages.fetchConversation})({actionTypes:m,context:c,meta:{conversationId:s,direction:Object(v.c)(e)}},(e=>{if(e){const{cards:t,entries:n,tweets:r,users:a,fleets:s}=e.entities,{conversations:c,max_entry_id:i,min_entry_id:o,status:d}=e.result.conversation_timeline,u=((e={},t)=>Object.entries(e).reduce(((e,[n,r])=>({...e,[n]:{...r,...t}})),{}))(c,{max_entry_id:i,min_entry_id:o,status:d});return Object(f.c)({conversations:u,entries:n,users:a,tweets:r,cards:t,fleets:s})}}))},Z=e=>(t,n,{api:a})=>r.b(t,{params:{participantIds:e},request:a.DirectMessages.fetchConversationFromParticipants})({actionTypes:N,meta:{participantIds:e}}),ee=(e={})=>(t,n)=>{const r=n(),{conversationId:a}=e,{data:s={}}=B(r,a)||{},c=Q(r,a);return(!s.status||s.status===E.c.HAS_MORE)&&!c?t($({conversationId:a,context:"FETCH_DM_CONVERSATION"})):Promise.resolve()},te=(e={})=>(t,n)=>{const r=n(),{conversationId:a}=e,{data:s}=B(r,a)||{},{status:c,min_entry_id:i}=s||{},o=Q(r,a);return c!==E.c.HAS_MORE||o?Promise.resolve():t($({...e,max_id:i,context:"FETCH_DM_CONVERSATION_HISTORY"}))},ne=e=>(t,n,{api:a})=>r.b(t,{params:{conversationId:e},request:a.DirectMessages.acceptConversation})({actionTypes:y,meta:{conversationId:e}}),re=(e,t)=>se(e,t,!0),ae=(e,t)=>se(e,t,!1),se=(e,t,n)=>(a,s,{api:c})=>r.b(a,{params:{userId:e,relationshipAction:n?"mute":"unmute",conversationId:t},request:c.DirectMessages.muteDMUser})({actionTypes:b,meta:{userId:e,conversationId:t,mute:n}}).then(a(I.e.patchUser(e,{dm_muting:n}))),ce=(e={})=>(t,n,{api:a})=>{const{conversationId:s}=e;return r.c(t,{params:e,request:a.DirectMessages.leaveConversation})({actionTypes:C,context:"ACTION_LEAVE_CONVERSATION",meta:{conversationId:s}})},ie=c.c("ADD_CONVERSATIONS"),oe=e=>({payload:e,type:ie}),de=c.c("MARK_ALL_AS_READ"),ue=e=>({payload:e,type:de}),_e=(e,t)=>({type:R.REQUEST,meta:{conversationId:e,lastReadEventId:t}}),Ee=e=>(t,n,{api:a})=>{const s=n(),{data:c={}}=B(s,e)||{},{sort_event_id:i}=c,o=!W(s,e);if(e&&i&&o){return r.c(t,{params:{conversationId:e,last_read_event_id:i},request:a.DirectMessages.markRead})({actionTypes:R,bypassFailureOnErrors:()=>!0,context:"APP_DM_UPDATE_CONVERSATION_READ_STATE",meta:{conversationId:e,lastReadEventId:i}})}return Promise.resolve()},le=c.c("REMOVE_CONVERSATION"),Ie=e=>[{payload:e,type:le},Object(O.i)(e)],Oe=c.c("TOGGLE_CONVERSATION_NOTIFICATIONS"),fe=(e,t)=>({meta:{conversationId:e},payload:t,type:Oe}),ve=(e={})=>(t,n,{api:a})=>{const{conversationId:s,duration:c}=e;return r.c(t,{params:e,request:a.DirectMessages.disableNotifications})({actionTypes:h,context:"ACTION_DISABLE_NOTIFICATIONS",meta:{conversationId:s,duration:c}})},Ae=(e={})=>(t,n,{api:a})=>{const{conversationId:s}=e;return r.c(t,{params:e,request:a.DirectMessages.enableNotifications})({actionTypes:j,context:"ACTION_ENABLE_NOTIFICATIONS",meta:{conversationId:s}})},pe=(e={})=>(t,n,{api:a})=>{const{conversationId:s}=e,c={mention_notifications_disabled:!0,...e};return r.c(t,{params:c,request:a.DirectMessages.updateMentionNotificationsSetting})({actionTypes:D,context:"ACTION_DISABLE_DM_MENTION_NOTIFICATIONS",meta:{conversationId:s}})},Se=(e={})=>(t,n,{api:a})=>{const{conversationId:s}=e,c={mention_notifications_disabled:!1,...e};return r.c(t,{params:c,request:a.DirectMessages.updateMentionNotificationsSetting})({actionTypes:M,context:"ACTION_ENABLE_DM_MENTION_NOTIFICATIONS",meta:{conversationId:s}})},ye=(e={})=>(t,n,{api:r})=>r.DirectMessages.updateTyping(e),be=(e={})=>(t,n,{api:a})=>{const{conversationId:s,name:c}=e;return r.c(t,{params:e,request:a.DirectMessages.updateConversationName})({actionTypes:g,context:"ACTION_UPDATE_CONVERSATION_NAME",meta:{conversationId:s,name:c}})},Te=e=>({type:g.SUCCESS,meta:{conversationId:e.conversation_id,name:e.conversation_name}}),me=c.c("UPDATE_CONVERSATION_MAX_ENTRY_ID"),Ne=(e,t)=>({meta:{conversationId:e},payload:t,type:me}),Ce=c.c("ADD_AVATAR_MEDIA"),Re=(e,t)=>({meta:{conversationId:e},payload:t,type:Ce}),De=c.c("REMOVE_AVATAR_MEDIA"),he=(e,t)=>({meta:{conversationId:e},payload:t,type:De}),Me=c.c("UPDATE_CONVERSATION_AVATAR"),je=(e,t)=>({meta:{conversationId:e},payload:t,type:Me}),ge="APP_DM_UPDATE_CONVERSATION_AVATAR",Ue=e=>(t,n,{api:s})=>{t({meta:{conversationId:e},type:U.REQUEST});const c=Y(n(),e),i=a.m(c);return t(i).then((([n])=>{t({meta:{conversationId:e},type:U.SUCCESS});return r.b(t,{params:{conversationId:e,avatar_id:n.uploadId},request:s.DirectMessages.updateConversationAvatar})({actionTypes:L,context:ge})}),(n=>{const r={errors:n,context:ge};return t({meta:{conversationId:e},type:U.FAILURE}),Promise.reject(r)}))},Le=(e,t)=>(n,a,{api:s})=>r.d(n,{params:{conversation_id:e,welcome_message_id:t},request:s.DirectMessages.addWelcomeMessageToConversation})("ADD_WELCOME_MESSAGE_TO_CONVERSATION")},uKEd:function(e,t,n){"use strict";n.d(t,"e",(function(){return b})),n.d(t,"a",(function(){return C})),n.d(t,"f",(function(){return R})),n.d(t,"d",(function(){return D})),n.d(t,"k",(function(){return h})),n.d(t,"i",(function(){return j})),n.d(t,"r",(function(){return g})),n.d(t,"h",(function(){return U})),n.d(t,"b",(function(){return P})),n.d(t,"j",(function(){return V})),n.d(t,"c",(function(){return B})),n.d(t,"g",(function(){return F})),n.d(t,"l",(function(){return Q})),n.d(t,"n",(function(){return H})),n.d(t,"o",(function(){return G})),n.d(t,"m",(function(){return k})),n.d(t,"p",(function(){return K})),n.d(t,"q",(function(){return W}));n("kYxP");var r=n("t0aI"),a=n("aWyx"),s=n("SrIh"),c=n("WVrH"),i=n("fEA7"),o=n.n(i),d=n("AQ79"),u=n("3A2y"),_=n("J4ZH"),E=n("4FGy"),l=n("s1N3"),I=n("lnti"),O=n("oEOe");const f=Object(O.a)(d.b,"DELETE_MESSAGE"),v=Object(O.a)(d.b,"REACTION_CREATE"),A=Object(O.a)(d.b,"REACTION_DELETE"),p=Object(O.a)(d.b,"MARK_ENTRIES_AS_SPAM"),S=Object(O.a)(d.b,"MARK_ENTRIES_AS_NOT_SPAM"),y={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}};function b(e=y,t){const{conversationId:n,requestId:r}=t.meta||{};switch(t.type){case L:{const{id:r}=t.payload,a={...e.entries,[r]:T(e.entries[r],{data:t.payload})};return{...e,entries:a,entryIdsByConversationId:{...e.entryIdsByConversationId,[n]:m([...e.entryIdsByConversationId[n]||[],r],a)}}}case N:{const n=Object.values(t.payload).filter((e=>e.type!==a.b.CONVERSATION_READ)).reduce(((t,n)=>{const{id:r}=n,s=Object(u.a)(n,"message_reactions");return t.allEntries[r]=T(e.entries[r],{data:s,isLoading:!1,isLoaded:!0}),n.message_reactions&&(n.message_reactions.forEach((r=>{const s={...r,affects_sort:!0,message_id:n.id,type:a.b.REACTION_CREATE};t.allEntries[s.id]=T(e.entries[s.id],{data:s,isLoading:!1,isLoaded:!0})})),t.embeddedReactionsByMessageId[r]=m([...e.reactionsByMessageId[r]||[],...n.message_reactions.map((e=>e.id))],{...e.entries,...t.allEntries})),t}),{allEntries:{},embeddedReactionsByMessageId:{}}),r={...e.entries,...n.allEntries},s=Object(_.a)(Object.values(n.allEntries),(e=>e.data.conversation_id)),c=Object.keys(s).reduce(((t,n)=>{const a=s[n].map((e=>e.data.id));return t[n]=m([...e.entryIdsByConversationId[n]||[],...a],r),t}),{});return{...e,entries:r,entryIdsByConversationId:{...e.entryIdsByConversationId,...c},reactionsByMessageId:{...e.reactionsByMessageId,...n.embeddedReactionsByMessageId}}}case p.REQUEST:case S.REQUEST:{const n=t.type===p.REQUEST,r=t.payload.reduce(((t,r)=>{const a=e.entries[r]&&e.entries[r].data;return{...t,[r]:{...e.entries[r],data:{...a,marked_as_spam:n}}}}),{});return{...e,entries:{...e.entries,...r}}}case f.REQUEST:case M:{const r=t.type===M&&!Array.isArray(t.payload),a=e.entryIdsByConversationId[n]||[],s=t.type===M?r?a:t.payload:[t.payload,...e.reactionsByMessageId[t.payload]||[]];return{...e,entries:Object(u.a)(e.entries,s),entryIdsByConversationId:{...Object(u.a)(e.entryIdsByConversationId,n),...r?{}:{[n]:Object(E.a)(a,s)}},reactionsByMessageId:Object(u.a)(e.reactionsByMessageId,s)}}case x:{const a=t.payload.id||r,s={...Object(u.a)(e.entries,a)},c=m((e.entryIdsByConversationId[n]||[]).filter((e=>e!==a)),s),i=c?{[n]:c}:{};return{...e,entries:s,entryIdsByConversationId:{...Object(u.a)(e.entryIdsByConversationId,n),...i},reactionsByMessageId:Object(u.a)(e.reactionsByMessageId,a)}}case w:{const n=t.payload,r=[...e.reactionsByMessageId[n.message_id]||[],n.id],a=r.filter((t=>e.entries[t]));r.length!==a.length&&Object(s.a)("DM add reaction is missing a backing entry",{extra:{filteredMessageReactionIds:a,messageReactionIds:r,currentId:n.id}});const c=m(a,e.entries);return{...e,reactionsByMessageId:{...e.reactionsByMessageId,[n.message_id]:c}}}case A.REQUEST:case q:{const n=t.payload,r=(e.reactionsByMessageId[n.message_id]||[]).find((t=>e.entries[t].data.sender_id===n.sender_id));if(!r)return e;const a=Object(E.a)(e.entryIdsByConversationId[n.conversation_id],r),s=Object(E.a)(e.reactionsByMessageId[n.message_id],r);return{...e,entries:Object(u.a)(e.entries,r),entryIdsByConversationId:{...e.entryIdsByConversationId,[n.conversation_id]:a},reactionsByMessageId:{...e.reactionsByMessageId,[n.message_id]:s}}}case c.a:return y;default:return e}}const T=(e,t)=>{const{error:n,isLoaded:r,isLoading:a,...s}=e||{},{data:c,...i}=t||{};return{...s,data:{...s&&s.data,...c},...i}},m=(e=[],t)=>{const n=Object(l.a)(e).sort(((e,n)=>{const a=Object(r.a)(t[e].data.time,t[n].data.time);return 0===a?Object(r.a)(t[e].id,t[n].id):a}));return n.length?n:void 0},N=Object(d.c)("ADD_ENTRIES"),C=e=>({payload:e,type:N}),R=e=>(t,n,{api:r})=>{const{id:a,conversationId:s,requestId:c=o.a.v1(),...i}=e||{},d={...i,id:a,request_id:c};return Object(O.c)(t,{params:d,request:r.DirectMessages.deleteMessage})({actionTypes:f,context:"ACTION_DELETE_DM",payload:a,meta:{conversationId:s}})},D=e=>(t,n,{api:r})=>{const s=(({reaction_key:e,conversation_id:t,dm_id:n,perspective:r})=>({id:o.a.v1(),time:(new Date).getTime().toString(),reaction_key:e,conversation_id:t,message_id:n,sender_id:r,type:a.b.REACTION_CREATE}))(e);t([P(s.conversation_id,s.id,s),F(s),B(s)]);return Object(O.b)(t,{params:Object(u.a)(e,"perspective"),request:r.DirectMessages.addReaction})({actionTypes:v,context:"ACTION_REACTION_CREATE"},((e,t)=>{if(t)return[F(s)]}))},h=e=>(t,n,{api:r})=>{const{perspective:a,...s}=e;return Object(O.c)(t,{params:s,request:r.DirectMessages.deleteReaction})({actionTypes:A,context:"ACTION_REACTION_DELETE",payload:{conversation_id:e.conversation_id,message_id:e.dm_id,sender_id:a}})},M="rweb/dm/REMOVE_CONVERSATION_ENTRIES",j=(e,t)=>({meta:{conversationId:e},payload:t,type:M}),g=(e,t)=>({payload:e,type:t?p.REQUEST:S.REQUEST}),U=({conversationId:e,dmId:t,markSpam:n})=>(r,a,{api:s})=>Object(O.c)(r,{params:{dm_id:t,report_as:n?"spam":"not_spam"},request:s.DirectMessages.reportSpam})({actionTypes:n?f:S,payload:n?t:[t],meta:{conversationId:e}}),L=Object(d.c)("ADD_ENTRY"),P=(e,t,n)=>({meta:{conversationId:e,requestId:t},payload:n,type:L}),x=Object(d.c)("REMOVE_ENTRY"),V=(e,t,n)=>({meta:{conversationId:e,requestId:t},payload:n,type:x}),w=Object(d.c)("ADD_REACTION"),B=e=>({payload:e,type:w}),q=Object(d.c)("DELETE_REACTION"),F=e=>({payload:e,type:q}),Q=e=>e[d.a].entries,H=(e,t)=>{const n=Q(e).entries[t];return n&&n.data},G=(e,t)=>e[d.a].entries.entryIdsByConversationId[t],k=(e,t)=>{const n=G(e,t);return n?Object(I.a)(n.map((t=>H(e,t)))):[]},K=(e,t)=>Q(e).reactionsByMessageId[t],W=(e,t)=>(K(e,t)||[]).map((t=>H(e,t).sender_id))},xCUF:function(e,t,n){"use strict";n.d(t,"c",(function(){return E})),n.d(t,"a",(function(){return I})),n.d(t,"b",(function(){return O})),n.d(t,"d",(function(){return f})),n.d(t,"f",(function(){return A})),n.d(t,"e",(function(){return b}));n("kYxP");var r=n("oEOe"),a=n("aWyx"),s=n("k6jb"),c=n("AQ79"),i=n("uKEd"),o=n("xPna"),d=n("lRnM"),u=n("WVrH"),_=n("P1r1");const E=r.a(c.b,"FETCH_UPDATES"),l={isLoaded:!1,isLoading:!1};function I(e=l,t){switch(t.type){case E.REQUEST:return{...e,isLoading:!0};case E.FAILURE:return{...e,error:t.payload,isLoaded:!1,isLoading:!1};case E.SUCCESS:{const{error:t,...n}=e;return{...n,isLoaded:!0,isLoading:!1}}case v:return{...e,cursor:t.payload};case p:return{...e,tertiaryInboxStatus:t.payload};case u.a:return l;default:return e}}const O=e=>(t,n,{api:a})=>{const c=n(),{directMessages:i={}}=c;let{cursor:d}=i.updates||{};const{polling:l,...I}=e||{},{tertiaryInboxStatus:O}=i.updates||{};let f=!1;const v=l?{"x-twitter-polling":"true"}:{},A=Object(_.p)(c);if(window.location.pathname.startsWith("/i/report"))return Promise.resolve();const p=[Object(_.r)(n())?"on":"off",A?"on":"off"].join();O?O!==p&&(d=null,f=!0):f=!0;const b=Object(o.j)({...I,muting_enabled:!0,nsfw_filtering_enabled:A,cursor:d},n());return r.b(t,{params:b,headers:v,request:a.DirectMessages.fetchUserUpdates})({actionTypes:E,context:"FETCH_DM_USER_UPDATES",meta:{direction:Object(s.c)(e)}},(e=>{if(e){const{entries:t,tweets:n,users:r,cards:a,fleets:s}=e.entities,{user_events:c,inbox_initial_state:i}=e.result;return[i&&Object(u.b)(),...Object(o.c)({...c||i,entries:t,users:r,tweets:n,cards:a,fleets:s}),...c?y(Object.values(t||[])):[],f&&S(p)]}}))},f=e=>(t,n)=>T(n())?Promise.resolve():t(O(e)),v=Object(c.c)("UPDATE_CURSOR"),A=e=>({payload:e,type:v}),p=Object(c.c)("UPDATE_TERTIARY_INBOX_STATUS"),S=e=>({payload:e,type:p}),y=(e=[])=>e.sort(((e,t)=>e.id-t.id)).reduce(((e,t)=>{switch(t.type){case a.b.CONVERSATION_AVATAR_UPDATE:return[...e,Object(d.I)(t.conversation_id,t.conversation_avatar_image_https),Object(d.J)(t.conversation_id,t.id)].filter((e=>e));case a.b.CONVERSATION_NAME_UPDATE:return[...e,Object(d.L)(t),Object(d.J)(t.conversation_id,t.id)].filter((e=>e));case a.b.CONVERSATION_READ:return[...e,Object(d.q)(t.conversation_id,t.last_read_event_id)];case a.b.DISABLE_NOTIFICATIONS:case a.b.ENABLE_NOTIFICATIONS:{const n=t.type===a.b.ENABLE_NOTIFICATIONS;return[...e,Object(d.G)(t.conversation_id,n)]}case a.b.MARK_ALL_AS_READ:return[...e,Object(d.p)(t.last_read_event_id)];case a.b.MESSAGE_DELETE:return[...e,Object(i.i)(t.conversation_id,t.messages.reduce(((e,t)=>[...e,...Object.values(t)]),[]))];case a.b.MESSAGE_MARK_AS_NOT_SPAM:case a.b.MESSAGE_MARK_AS_SPAM:{const n=t.type===a.b.MESSAGE_MARK_AS_SPAM;return[...e,Object(i.r)(t.messages.reduce(((e,t)=>[...e,...Object.values(t)]),[]),n)]}case a.b.REMOVE_CONVERSATION:return[...e,...Object(d.t)(t.conversation_id)];case a.b.JOIN_CONVERSATION:case a.b.PARTICIPANTS_JOIN:case a.b.PARTICIPANTS_LEAVE:return[...e,Object(d.J)(t.conversation_id,t.id)];case a.b.REACTION_CREATE:return[...e,Object(i.g)(t),Object(i.c)(t),Object(d.J)(t.conversation_id,t.id)];case a.b.REACTION_DELETE:return[...e,Object(i.g)(t)];case a.b.MESSAGE:return[...e,Object(d.J)(t.conversation_id,t.id)].filter((e=>e));default:return e}}),[]),b=e=>e[c.a].updates,T=e=>b(e).isLoading},xPna:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return N})),n.d(t,"d",(function(){return R})),n.d(t,"j",(function(){return M})),n.d(t,"s",(function(){return L})),n.d(t,"o",(function(){return P})),n.d(t,"n",(function(){return x})),n.d(t,"v",(function(){return V})),n.d(t,"x",(function(){return w})),n.d(t,"p",(function(){return B})),n.d(t,"r",(function(){return q})),n.d(t,"q",(function(){return F})),n.d(t,"m",(function(){return G})),n.d(t,"t",(function(){return k})),n.d(t,"y",(function(){return K})),n.d(t,"u",(function(){return W})),n.d(t,"w",(function(){return Y})),n.d(t,"e",(function(){return X})),n.d(t,"f",(function(){return z})),n.d(t,"h",(function(){return Z})),n.d(t,"i",(function(){return ee})),n.d(t,"g",(function(){return te})),n.d(t,"c",(function(){return ae})),n.d(t,"B",(function(){return se})),n.d(t,"C",(function(){return ce})),n.d(t,"A",(function(){return ie})),n.d(t,"l",(function(){return de})),n.d(t,"z",(function(){return Ee})),n.d(t,"k",(function(){return le}));n("kYxP");var r=n("oEOe");var a=n("/kEJ"),s=n("uKEd"),c=n("4q8G"),i=n("kGix"),o=n("aWyx"),d=n("WVrH"),u=n("xCUF"),_=n("AQ79"),E=n("lRnM"),l=n("tn7R"),I=n("YeIG"),O=n("t0aI"),f=n("P1r1");const v="rweb.dmDrawerVisibility",A=r.a(_.b,"FETCH_INBOX"),p=r.a(_.b,"UPDATE_LAST_SEEN_EVENT_ID"),S="inbox",y="trusted",b="untrusted",T="untrusted_low_quality",m=Object.freeze({CLOSED:"closed",COLLAPSED:"collapsed",EXPANDED:"expanded"}),N={primary:"primary",secondary:"secondary",tertiary:"tertiary"},C={cursors:{[S]:{fetchStatus:i.a.NONE},[y]:{fetchStatus:i.a.NONE},[b]:{fetchStatus:i.a.NONE},[T]:{fetchStatus:i.a.NONE}},lastSeenEventIds:{},poppedOutConversationId:null,drawerVisibility:m.COLLAPSED,drawerExperimentEnabled:!1};function R(e=C,t){switch(t.type){case A.REQUEST:{const{timelineType:n}=t.meta;return{...e,cursors:{...e.cursors,[n]:{...e.cursors[n],fetchStatus:i.a.LOADING}}}}case A.FAILURE:{const{timelineType:n}=t.meta;return{...e,cursors:{...e.cursors,[n]:{...e.cursors[n],error:t.payload,fetchStatus:i.a.FAILED}}}}case A.SUCCESS:{const{timelineType:n}=t.meta;return{...e,cursors:{...e.cursors,[n]:{...e.cursors[n],error:void 0,fetchStatus:i.a.LOADED}}}}case ne:return{...e,cursors:{...e.cursors,...t.payload.cursors},lastSeenEventIds:D(e.lastSeenEventIds,t.payload.lastSeenEventIds)};case p.REQUEST:return{...e,lastSeenEventIds:{...e.lastSeenEventIds,...t.meta.lastSeenEventIds}};case d.a:return{...C,cursors:{...C.cursors,inbox:e.cursors.inbox}};case oe:return{...e,poppedOutConversationId:t.conversationId,drawerVisibility:m.EXPANDED};case ue:return{...e,drawerVisibility:t.visibility};default:return e}}const D=(e,t)=>({last_seen_event_id:h(e.last_seen_event_id,t.last_seen_event_id),trusted_last_seen_event_id:h(e.trusted_last_seen_event_id,t.trusted_last_seen_event_id),untrusted_last_seen_event_id:h(e.untrusted_last_seen_event_id,t.untrusted_last_seen_event_id)}),h=(e,t)=>Object(O.c)(e,t)?e:t,M=(e,t,n="all")=>{const r=Object(f.r)(t),a=Object(f.q)(t);return r?{...e,filter_low_quality:a,include_quality:n}:e},j=e=>e[_.a].inbox,g=e=>j(e).cursors,U=e=>j(e).lastSeenEventIds,L=e=>j(e).poppedOutConversationId,P=e=>j(e).drawerVisibility,x=e=>j(e).drawerExperimentEnabled,V=e=>g(e)[b],w=e=>g(e)[T],B=e=>(e=>g(e)[S])(e).fetchStatus,q=e=>B(e)===i.a.LOADING,F=e=>B(e)===i.a.LOADED,Q={[N.primary]:e=>e.trusted,[N.secondary]:(e,t,n)=>t?!(e.trusted||e.muted||n&&e.nsfw||e.low_quality):!(e.trusted||e.muted||n&&e.nsfw),[N.tertiary]:(e,t,n)=>t?!e.trusted&&(e.muted||e.low_quality||n&&e.nsfw):!e.trusted&&(e.muted||n&&e.nsfw)},H=(e,t)=>{const n=Object(f.q)(e),r=Object(f.p)(e);return Object(l.a)(Object(E.C)(e)).filter((e=>Q[t](e.data,n,r)))},G=(e,t)=>H(e,t).map((e=>e.data)).sort(c.a).map((e=>e.conversation_id)),k=e=>{const t=H(e,N.primary),n=H(e,N.secondary),r=t.concat(n),{last_seen_event_id:a}=U(e);return J(e,r,a)},K=e=>{const t=H(e,N.secondary),{untrusted_last_seen_event_id:n}=U(e);return J(e,t,n)},W=e=>{const t=H(e,N.secondary),n=H(e,N.tertiary);return t.length+n.length},Y=e=>H(e,N.tertiary).length,J=(e,t,n)=>n?t.reduce(((t,{data:{conversation_id:r}})=>{const a=Object(E.B)(e,r),s=Object(E.A)(e,r);return a&&Object(O.b)(a,n)&&!s?t+1:t}),0):0,X=(e={})=>(t,n,{api:a})=>{const s=n(),c=Object(f.p)(s),i=M({muting_enabled:!0,nsfw_filtering_enabled:c,...e},n());return r.b(t,{params:i,request:a.DirectMessages.fetchUserInbox})({actionTypes:A,context:"FETCH_DM_INBOX",meta:{timelineType:S}},(e=>{if(e){const{entries:t,users:n,tweets:r,cards:a,fleets:s}=e.entities;return ae({...e.result.inbox_initial_state,entries:t,users:n,tweets:r,cards:a,fleets:s})}}))},z=(e={})=>(t,n)=>{const r=n(),a=B(r);return a!==i.a.LOADED&&a!==i.a.LOADING?t(X(e)):Promise.resolve()},$=(e,t,n=0)=>(a,s,{api:c})=>{const i=s(),d=Object(f.p)(i),{status:u,min_entry_id:_}=g(i)[e],E=e===T?b:e,l={...t,max_id:_,timelineType:E,muting_enabled:e!==y,nsfw_filtering_enabled:d};if(u!==o.c.HAS_MORE)return Promise.resolve();return r.b(a,{params:l,request:c.DirectMessages.fetchInboxHistory})({actionTypes:A,context:"FETCH_DM_INBOX_HISTORY",meta:{timelineType:e}},(t=>{if(t){const{entries:n,users:r,tweets:a,cards:s,fleets:c}=t.entities,{inbox_timeline:i}=t.result;return ae({conversations:i.conversations,inbox_timelines:{[e]:i},entries:n,users:r,tweets:a,cards:s,fleets:c})}})).then((r=>{const s=r.result.inbox_timeline;if(n<3&&!s.conversations&&s.status===o.c.HAS_MORE)return a($(e,t,n+1))}))},Z=e=>(t,n)=>{const r=M(e,n(),"high");return t($(b,r))},ee=e=>(t,n)=>{const r=M(e,n(),"low");return t($(T,r))},te=e=>(t,n)=>{const r=M(e,n());return t($(y,r))},ne=Object(_.c)("UPDATE_INBOX"),re=e=>{const{inbox_timelines:t,...n}=e;return{payload:{cursors:t,lastSeenEventIds:n},type:ne}},ae=(e={})=>{const{conversations:t,entries:n,users:r,tweets:c,cards:i,fleets:o,cursor:d,..._}=e;var l;return[Object(a.c)({cards:i,tweets:c,users:r}),!Object(I.a)(t)&&Object(E.c)(t),!Object(I.a)(n)&&Object(s.a)(n),!Object(I.a)(d)&&Object(u.f)(d),!Object(I.a)(_)&&re(_),!Object(I.a)(o)&&(l=o,e=>{e({payload:{fleets:l},type:"rweb/fleets/ADD_DM_FLEETS"})})].filter((e=>e))},se=()=>e=>e(ie({withTrusted:!0})),ce=()=>e=>e(ie({withUntrusted:!0})),ie=({withTrusted:e,withUntrusted:t}={})=>(n,a,{api:s})=>{const c=a(),i=Object(E.C)(c),o=U(c),{last_seen_event_id:d,trusted_last_seen_event_id:u,untrusted_last_seen_event_id:_}=o,l=Object.values(i).reduce(((e,{data:{sort_event_id:t,trusted:n}})=>(e.last_seen_event_id=h(e.last_seen_event_id,t),e.trusted_last_seen_event_id=n?h(e.trusted_last_seen_event_id,t):e.trusted_last_seen_event_id,e.untrusted_last_seen_event_id=n?e.untrusted_last_seen_event_id:h(e.untrusted_last_seen_event_id,t),e)),{...o});if(Object(O.b)(l.last_seen_event_id,d)||e&&Object(O.b)(l.trusted_last_seen_event_id,u)||t&&Object(O.b)(l.untrusted_last_seen_event_id,_)){e||delete l.trusted_last_seen_event_id,t||delete l.untrusted_last_seen_event_id;return r.c(n,{params:l,request:s.DirectMessages.updateLastSeenEventId})({actionTypes:p,context:"APP_DM_UPDATE_LAST_SEEN",meta:{lastSeenEventIds:l}})}return Promise.resolve()},oe=Object(_.c)("POP_OUT_CONVERSATION"),de=e=>(t,n,{userPersistence:r})=>(r.set(v,{visibility:m.EXPANDED}),t({conversationId:e,type:oe})),ue=Object(_.c)("SET_DRAWER_VISIBILITY"),_e=e=>({visibility:e,type:ue}),Ee=e=>(t,n,{userPersistence:r})=>(r.set(v,{visibility:e}),e===m.CLOSED&&t({type:oe}),t(_e(e))),le=()=>(e,t,{userPersistence:n})=>n.get(v).then((t=>{t&&e(_e(t.visibility))}))}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.directMessagesData.65c30325.js.map